(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[733],{94785:function(e,t,n){"use strict";n.d(t,{Z:function(){return f}});var r=n(92809),a=n(10219),u=(n(67294),n(33114)),i=n(35005),c=n(65850),o=n(85893),s=["attributes","children"];function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function f(e){var t,n,r,l,f,d,A=e.attributes,h=e.children,v=(0,a.Z)(e,s);return A?(0,o.jsxs)(u.Z,p(p({},v),{},{onHide:A.nonClosable?function(){return null}:v.onHide,centered:!0,backdrop:!A.staticBackdrop||"static",children:[(0,o.jsx)(u.Z.Header,{style:{borderBottom:"none"},closeButton:!A.nonClosable,children:A.title&&(0,o.jsx)(u.Z.Title,{children:A.title})}),(h||(null===A||void 0===A?void 0:A.content))&&(0,o.jsx)(u.Z.Body,{style:{borderTop:"1px solid #444"},children:h||(0,o.jsx)("p",{style:{fontSize:"1.25rem",marginBottom:0},children:A.content})}),(A.close||A.proceed)&&(0,o.jsx)(u.Z.Footer,{style:{borderTop:"none"},children:(0,o.jsxs)("div",{style:{display:"flex",flexWrap:"wrap"},children:[A.close&&(0,o.jsx)(i.Z,{variant:"outline-".concat(null!==(t=null===(n=A.close)||void 0===n?void 0:n.variant)&&void 0!==t?t:"secondary"),onClick:function(){var e;A.close.action&&(null===(e=A.close)||void 0===e||e.action()),v.onHide()},style:{padding:"6px 3em",margin:"0 20px",marginBottom:"20px",flex:1,whiteSpace:"nowrap"},children:null!==(r=null===(l=A.close)||void 0===l?void 0:l.text)&&void 0!==r?r:c.Z.OK}),A.proceed&&(0,o.jsx)(i.Z,{variant:"outline-".concat(null!==(f=null===(d=A.proceed)||void 0===d?void 0:d.variant)&&void 0!==f?f:"primary"),onClick:function(){A.proceed.action(),v.onHide()},style:{padding:"6px 3em",margin:"0 20px",marginBottom:"20px",flex:1,whiteSpace:"nowrap"},disabled:A.proceed.disabled,children:A.proceed.text})]})})]})):(0,o.jsx)(u.Z,{})}},61975:function(e,t,n){"use strict";n.d(t,{dn:function(){return g},lN:function(){return b}});var r=n(30266),a=n(10219),u=n(809),i=n.n(u),c=n(67294),o=n(76102),s=n(8635),l=n(65850),p=n(94785),f=n(39151),d=n(91288),A=n(85893),h=["somethingWentWrong"],v=n(2153);v.setDefaultWordlist("english");var g=d.ZP.div.withConfig({displayName:"RecoveryKeyModal__CodeBlock",componentId:"sc-17nsj3l-0"})(["display:flex;align-items:center;justify-content:center;background:#1a1919;height:","px;padding-left:30px;padding-right:20px;color:white;margin:20px 0;width:100%;"],(function(e){return e.height})),b=d.ZP.div.withConfig({displayName:"RecoveryKeyModal__FreeFlowText",componentId:"sc-17nsj3l-1"})(["word-wrap:break-word;overflow-wrap:break-word;min-width:30%;text-align:left;"]);t.ZP=function(e){var t=e.somethingWentWrong,n=(0,a.Z)(e,h),u=(0,c.useState)(null),d=u[0],m=u[1];function y(){n.onHide()}return(0,c.useEffect)((function(){n.show&&function(){var e=(0,r.Z)(i().mark((function e(){var r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,s.yr)();case 2:(r=e.sent)||(t(),n.onHide()),m(v.entropyToMnemonic(r));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()()}),[n.show]),(0,A.jsxs)(p.Z,{show:n.show,onHide:y,size:"lg",attributes:{title:l.Z.DOWNLOAD_RECOVERY_KEY,close:{text:l.Z.SAVE_LATER,variant:"danger"},staticBackdrop:!0,proceed:{text:l.Z.SAVE,action:function(){(0,o.KG)(l.Z.RECOVERY_KEY_FILENAME,d),y()},disabled:!d,variant:"success"}},children:[(0,A.jsx)("p",{children:l.Z.RECOVERY_KEY_DESCRIPTION}),(0,A.jsx)(g,{height:150,children:d?(0,A.jsx)(b,{children:d}):(0,A.jsx)(f.Z,{})}),(0,A.jsx)("p",{children:l.Z.KEY_NOT_STORED_DISCLAIMER})]})}},27145:function(e,t,n){"use strict";n.d(t,{_:function(){return g}});var r,a=n(30266),u=n(68216),i=n(25997),c=n(809),o=n.n(c),s=n(9618),l=n(68487),p=n(35641),f=n(99424),d=n(44796),A=n(5567),h=n(63255),v=(0,s.O3)();!function(e){e.Buy="buy",e.Update="update"}(r||(r={}));var g="free",b=function(){function e(){(0,u.Z)(this,e)}return(0,i.Z)(e,[{key:"getPlans",value:function(){var e=(0,a.Z)(o().mark((function e(){var t,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,d.Z.get("".concat(v,"/billing/plans/v2"));case 3:return t=e.sent,n=t.data.plans,e.abrupt("return",n);case 8:e.prev=8,e.t0=e.catch(0),(0,A.H)(e.t0,"failed to get plans");case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}()},{key:"syncSubscription",value:function(){var e=(0,a.Z)(o().mark((function e(){var t,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,d.Z.get("".concat(v,"/billing/subscription"),null,{"X-Auth-Token":(0,l.LP)()});case 3:t=e.sent,n=t.data.subscription,(0,p.a_)(p.Pd.SUBSCRIPTION,n),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),(0,A.H)(e.t0,"failed to get user's subscription details");case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}()},{key:"buySubscription",value:function(){var e=(0,a.Z)(o().mark((function e(t){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,h.WO)();case 3:return n=e.sent,e.next=6,this.redirectToPayments(n,t,r.Buy);case 6:e.next=12;break;case 8:throw e.prev=8,e.t0=e.catch(0),(0,A.H)(e.t0,"unable to buy subscription"),e.t0;case 12:case"end":return e.stop()}}),e,this,[[0,8]])})));return function(t){return e.apply(this,arguments)}}()},{key:"updateSubscription",value:function(){var e=(0,a.Z)(o().mark((function e(t){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,h.WO)();case 3:return n=e.sent,e.next=6,this.redirectToPayments(n,t,r.Update);case 6:e.next=12;break;case 8:throw e.prev=8,e.t0=e.catch(0),(0,A.H)(e.t0,"subscription update failed"),e.t0;case 12:case"end":return e.stop()}}),e,this,[[0,8]])})));return function(t){return e.apply(this,arguments)}}()},{key:"cancelSubscription",value:function(){var e=(0,a.Z)(o().mark((function e(){var t,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,d.Z.post("".concat(v,"/billing/stripe/cancel-subscription"),null,null,{"X-Auth-Token":(0,l.LP)()});case 3:t=e.sent,n=t.data.subscription,(0,p.a_)(p.Pd.SUBSCRIPTION,n),e.next=12;break;case 8:throw e.prev=8,e.t0=e.catch(0),(0,A.H)(e.t0,"subscription cancel failed"),e.t0;case 12:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}()},{key:"activateSubscription",value:function(){var e=(0,a.Z)(o().mark((function e(){var t,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,d.Z.post("".concat(v,"/billing/stripe/activate-subscription"),null,null,{"X-Auth-Token":(0,l.LP)()});case 3:t=e.sent,n=t.data.subscription,(0,p.a_)(p.Pd.SUBSCRIPTION,n),e.next=12;break;case 8:throw e.prev=8,e.t0=e.catch(0),(0,A.H)(e.t0,"failed to activate subscription"),e.t0;case 12:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}()},{key:"verifySubscription",value:function(){var e=(0,a.Z)(o().mark((function e(){var t,n,r,a,u=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=u.length>0&&void 0!==u[0]?u[0]:null,e.prev=1,n=(0,l.LP)()){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,d.Z.post("".concat(v,"/billing/verify-subscription"),{paymentProvider:"stripe",productID:null,VerificationData:t},null,{"X-Auth-Token":n});case 7:return r=e.sent,a=r.data.subscription,(0,p.a_)(p.Pd.SUBSCRIPTION,a),e.abrupt("return",a);case 13:throw e.prev=13,e.t0=e.catch(1),(0,A.H)(e.t0,"Error while verifying subscription"),e.t0;case 17:case"end":return e.stop()}}),e,null,[[1,13]])})));return function(){return e.apply(this,arguments)}}()},{key:"redirectToPayments",value:function(){var e=(0,a.Z)(o().mark((function e(t,n,r){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,window.location.href="".concat((0,s.X2)(),"?productID=").concat(n,"&paymentToken=").concat(t,"&action=").concat(r,"&redirectURL=").concat(window.location.origin,"/gallery"),e.next=8;break;case 4:throw e.prev=4,e.t0=e.catch(0),(0,A.H)(e.t0,"unable to get payments url"),e.t0;case 8:case"end":return e.stop()}}),e,null,[[0,4]])})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"redirectToCustomerPortal",value:function(){var e=(0,a.Z)(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,d.Z.get("".concat(v,"/billing/stripe/customer-portal"),{redirectURL:"".concat(window.location.origin,"/gallery")},{"X-Auth-Token":(0,l.LP)()});case 3:t=e.sent,window.location.href=t.data.url,e.next=11;break;case 7:throw e.prev=7,e.t0=e.catch(0),(0,A.H)(e.t0,"unable to get customer portal url"),e.t0;case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}()},{key:"getUsage",value:function(){var e=(0,a.Z)(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,d.Z.get("".concat(v,"/billing/usage"),{startTime:0,endTime:1e3*Date.now()},{"X-Auth-Token":(0,l.LP)()});case 3:return t=e.sent,e.abrupt("return",(0,f.pe)(t.data.usage));case 7:e.prev=7,e.t0=e.catch(0),(0,A.H)(e.t0,"error getting usage");case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}()}]),e}();t.Z=new b},39903:function(e,t,n){"use strict";var r=n(30266),a=n(68216),u=n(25997),i=n(92809),c=n(809),o=n.n(c),s=n(68487),l=n(9618),p=n(8635),f=n(76102),d=n(44796),A=n(39890),h=n(5567),v=function(){function e(){var t=this;(0,a.Z)(this,e),(0,i.Z)(this,"fileObjectUrlPromise",new Map),(0,i.Z)(this,"thumbnailObjectUrlPromise",new Map),(0,i.Z)(this,"downloadThumb",function(){var e=(0,r.Z)(o().mark((function e(t,n){var r,a,u;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.Z.get((0,l.gu)(n.id),null,{"X-Auth-Token":t},{responseType:"arraybuffer"});case 2:return r=e.sent,e.next=5,new p.ZP;case 5:return a=e.sent,e.t0=a,e.t1=new Uint8Array(r.data),e.next=10,a.fromB64(n.thumbnail.decryptionHeader);case 10:return e.t2=e.sent,e.t3=n.key,e.next=14,e.t0.decryptThumbnail.call(e.t0,e.t1,e.t2,e.t3);case 14:return u=e.sent,e.abrupt("return",u);case 16:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),(0,i.Z)(this,"getFile",function(){var e=(0,r.Z)(o().mark((function e(n){var a,u,i,c,s,l=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=l.length>1&&void 0!==l[1]&&l[1],u=a&&(0,f.SG)(n),i=u?"".concat(n.id,"_converted"):"".concat(n.id),e.prev=3,c=function(){var e=(0,r.Z)(o().mark((function e(r){var a,u;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.downloadFile(n);case 2:return a=e.sent,e.next=5,new Response(a).blob();case 5:if(u=e.sent,!r){e.next=10;break}return e.next=9,(0,f.au)(n,u);case 9:u=e.sent;case 10:return e.abrupt("return",URL.createObjectURL(u));case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),t.fileObjectUrlPromise.get(i)||t.fileObjectUrlPromise.set(i,c(u)),e.next=8,t.fileObjectUrlPromise.get(i);case 8:return s=e.sent,e.abrupt("return",s);case 12:throw e.prev=12,e.t0=e.catch(3),t.fileObjectUrlPromise.delete(i),(0,h.H)(e.t0,"Failed to get File"),e.t0;case 17:case"end":return e.stop()}}),e,null,[[3,12]])})));return function(t){return e.apply(this,arguments)}}())}return(0,u.Z)(e,[{key:"getThumbnail",value:function(){var e=(0,r.Z)(o().mark((function e(t){var n,a,u=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,n=(0,s.LP)()){e.next=4;break}return e.abrupt("return",null);case 4:return this.thumbnailObjectUrlPromise.get(t.id)||(a=function(){var e=(0,r.Z)(o().mark((function e(){var r,a,i,c;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,caches.open("thumbs");case 2:return r=e.sent,e.next=5,r.match(t.id.toString());case 5:if(!(a=e.sent)){e.next=12;break}return e.t0=URL,e.next=10,a.blob();case 10:return e.t1=e.sent,e.abrupt("return",e.t0.createObjectURL.call(e.t0,e.t1));case 12:return e.next=14,u.downloadThumb(n,t);case 14:return i=e.sent,c=new Blob([i]),e.prev=16,e.next=19,r.put(t.id.toString(),new Response(c));case 19:e.next=23;break;case 21:e.prev=21,e.t2=e.catch(16);case 23:return e.abrupt("return",URL.createObjectURL(c));case 24:case"end":return e.stop()}}),e,null,[[16,21]])})));return function(){return e.apply(this,arguments)}}(),this.thumbnailObjectUrlPromise.set(t.id,a())),e.next=7,this.thumbnailObjectUrlPromise.get(t.id);case 7:return e.abrupt("return",e.sent);case 10:throw e.prev=10,e.t0=e.catch(0),this.thumbnailObjectUrlPromise.delete(t.id),(0,h.H)(e.t0,"get preview Failed"),e.t0;case 15:case"end":return e.stop()}}),e,this,[[0,10]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getCachedOriginalFile",value:function(){var e=(0,r.Z)(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fileObjectUrlPromise.get(t.id.toString());case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"downloadFile",value:function(){var e=(0,r.Z)(o().mark((function e(t){var n,a,u,i,c,h,v;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new p.ZP;case 2:if(n=e.sent,a=(0,s.LP)()){e.next=6;break}return e.abrupt("return",null);case 6:if(t.metadata.fileType!==A.Gk.IMAGE&&t.metadata.fileType!==A.Gk.LIVE_PHOTO){e.next=20;break}return e.next=9,d.Z.get((0,l.qm)(t.id),null,{"X-Auth-Token":a},{responseType:"arraybuffer"});case 9:return u=e.sent,e.t0=n,e.t1=new Uint8Array(u.data),e.next=14,n.fromB64(t.file.decryptionHeader);case 14:return e.t2=e.sent,e.t3=t.key,e.next=18,e.t0.decryptFile.call(e.t0,e.t1,e.t2,e.t3);case 18:return i=e.sent,e.abrupt("return",(0,f.jR)(i));case 20:return e.next=22,fetch((0,l.qm)(t.id),{headers:{"X-Auth-Token":a}});case 22:return c=e.sent,h=c.body.getReader(),v=new ReadableStream({start:function(e){return(0,r.Z)(o().mark((function a(){var u,i,c,s,l,p,f;return o().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return f=function(){h.read().then(function(){var t=(0,r.Z)(o().mark((function t(r){var a,u,i,c,d,A,h,v;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=r.done,u=r.value,a){t.next=19;break}if((i=new Uint8Array(p.byteLength+u.byteLength)).set(new Uint8Array(p),0),i.set(new Uint8Array(u),p.byteLength),!(i.length>l)){t.next=15;break}return c=i.slice(0,l),t.next=9,n.decryptChunk(c,s);case 9:d=t.sent,A=d.decryptedData,e.enqueue(A),p=i.slice(l),t.next=16;break;case 15:p=i;case 16:f(),t.next=27;break;case 19:if(!p){t.next=26;break}return t.next=22,n.decryptChunk(p,s);case 22:h=t.sent,v=h.decryptedData,e.enqueue(v),p=null;case 26:e.close();case 27:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},a.next=3,n.fromB64(t.file.decryptionHeader);case 3:return u=a.sent,a.next=6,n.fromB64(t.key);case 6:return i=a.sent,a.next=9,n.initDecryption(u,i);case 9:c=a.sent,s=c.pullState,l=c.decryptionChunkSize,p=new Uint8Array,f();case 14:case"end":return a.stop()}}),a)})))()}}),e.abrupt("return",v);case 26:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}();t.Z=new v},39890:function(e,t,n){"use strict";n.d(t,{lI:function(){return k},E9:function(){return C},Si:function(){return E},Uw:function(){return K},Gk:function(){return y},Rj:function(){return T},YU:function(){return Z},Zt:function(){return P},dm:function(){return O},EL:function(){return I},Z0:function(){return M},N5:function(){return D},be:function(){return L},FA:function(){return B},NA:function(){return j}});var r=n(92809),a=n(80318),u=n(83789),i=n(30266),c=n(809),o=n.n(c),s=n(9618),l=n(58877),p=n(68487),f=n(44796),d=n(5567),A=n(76102),h=n(8635);function v(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?v(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function b(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return m(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return m(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var u,i=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){c=!0,u=e},f:function(){try{i||null==n.return||n.return()}finally{if(c)throw u}}}}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var y,x=(0,s.O3)(),w="files",k=new Date(1800,0,1),C=new Date,E=new Date(1800,0,1,23,59,59),K=100;!function(e){e[e.IMAGE=0]="IMAGE",e[e.VIDEO=1]="VIDEO",e[e.LIVE_PHOTO=2]="LIVE_PHOTO",e[e.OTHERS=3]="OTHERS"}(y||(y={}));var Z,T=[{fileType:y.IMAGE,exactType:"jpeg"},{fileType:y.IMAGE,exactType:"jpg"},{fileType:y.VIDEO,exactType:"webm"}];!function(e){e[e.VISIBLE=0]="VISIBLE",e[e.ARCHIVED=1]="ARCHIVED"}(Z||(Z={}));var P={version:0,data:{},header:null,count:0},O=function(){var e=(0,i.Z)(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.Z.getItem(w);case 2:if(e.t0=e.sent,e.t0){e.next=5;break}e.t0=[];case 5:return t=e.t0,e.abrupt("return",t);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),I=function(){var e=(0,i.Z)(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.Z.setItem(w,t);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),S=function(){var e=(0,i.Z)(o().mark((function e(t){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.Z.getItem("".concat(t.id,"-time"));case 2:if(e.t1=n=e.sent,e.t0=null!==e.t1,!e.t0){e.next=6;break}e.t0=void 0!==n;case 6:if(!e.t0){e.next=10;break}e.t2=n,e.next=11;break;case 10:e.t2=0;case 11:return e.abrupt("return",e.t2);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),M=function(){var e=(0,i.Z)(o().mark((function e(t,n){var r,i,c,s,f;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O();case 2:return r=e.sent,e.next=5,R(t,r);case 5:if((i=e.sent).length===r.length){e.next=10;break}return e.next=9,I(i);case 9:n((0,u.Z)((0,A.hE)((0,A.SA)(i))));case 10:c=b(t),e.prev=11,f=o().mark((function e(){var t,r,c,f,d,h,v,g,m,y;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=s.value,(0,p.LP)()){e.next=3;break}return e.abrupt("return","continue");case 3:return e.next=5,S(c);case 5:if(f=e.sent,c.updationTime!==f){e.next=8;break}return e.abrupt("return","continue");case 8:return e.next=10,U(c,f,i,n);case 10:if(e.t1=t=e.sent,e.t0=null!==e.t1,!e.t0){e.next=14;break}e.t0=void 0!==t;case 14:if(!e.t0){e.next=18;break}e.t2=t,e.next=19;break;case 18:e.t2=[];case 19:d=e.t2,(r=i).push.apply(r,(0,u.Z)(d)),h=new Map,i.forEach((function(e){var t="".concat(e.collectionID,"-").concat(e.id);(!h.has(t)||h.get(t).updationTime<e.updationTime)&&h.set(t,e)})),i=[],v=b(h),e.prev=25,v.s();case 27:if((g=v.n()).done){e.next=34;break}if(m=(0,a.Z)(g.value,2),m[0],!(y=m[1]).isDeleted){e.next=31;break}return e.abrupt("continue",32);case 31:i.push(y);case 32:e.next=27;break;case 34:e.next=39;break;case 36:e.prev=36,e.t3=e.catch(25),v.e(e.t3);case 39:return e.prev=39,v.f(),e.finish(39);case 42:return e.next=44,I(i);case 44:return e.next=46,l.Z.setItem("".concat(c.id,"-time"),c.updationTime);case 46:n((0,u.Z)((0,A.hE)((0,A.SA)(i))));case 47:case"end":return e.stop()}}),e,null,[[25,36,39,42]])})),c.s();case 14:if((s=c.n()).done){e.next=21;break}return e.delegateYield(f(),"t0",16);case 16:if("continue"!==e.t0){e.next=19;break}return e.abrupt("continue",19);case 19:e.next=14;break;case 21:e.next=26;break;case 23:e.prev=23,e.t1=e.catch(11),c.e(e.t1);case 26:return e.prev=26,c.f(),e.finish(26);case 29:return e.abrupt("return",(0,A.hE)((0,A.SA)(i)));case 30:case"end":return e.stop()}}),e,null,[[11,23,26,29]])})));return function(t,n){return e.apply(this,arguments)}}(),U=function(){var e=(0,i.Z)(o().mark((function e(t,n,r,a){var c,s,l,h;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,c=[],s=n;case 3:if(h=(0,p.LP)()){e.next=6;break}return e.abrupt("break",20);case 6:return e.next=8,f.Z.get("".concat(x,"/collections/v2/diff"),{collectionID:t.id,sinceTime:s},{"X-Auth-Token":h});case 8:return l=e.sent,e.t0=c.push,e.t1=c,e.t2=u.Z,e.next=14,Promise.all(l.data.diff.map(function(){var e=(0,i.Z)(o().mark((function e(n){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.isDeleted){e.next=4;break}return e.next=3,(0,A.np)(n,t);case 3:n=e.sent;case 4:return e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 14:e.t3=e.sent,e.t4=(0,e.t2)(e.t3),e.t0.apply.call(e.t0,e.t1,e.t4),l.data.diff.length&&(s=l.data.diff.slice(-1)[0].updationTime),a((0,A.hE)((0,A.SA)([].concat((0,u.Z)(r||[]),c).filter((function(e){return!e.isDeleted})))));case 19:if(l.data.hasMore){e.next=3;break}case 20:return e.abrupt("return",c);case 23:e.prev=23,e.t5=e.catch(0),(0,d.H)(e.t5,"Get files failed");case 26:case"end":return e.stop()}}),e,null,[[0,23]])})));return function(t,n,r,a){return e.apply(this,arguments)}}(),R=function(){var e=(0,i.Z)(o().mark((function e(t,n){var r,a,u,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=new Set,a=b(t);try{for(a.s();!(u=a.n()).done;)i=u.value,r.add(i.id)}catch(c){a.e(c)}finally{a.f()}return n=n.filter((function(e){return r.has(e.collectionID)})),e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),D=function(){var e=(0,i.Z)(o().mark((function e(t){var n,r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,n=(0,p.LP)()){e.next=4;break}return e.abrupt("return");case 4:return r={items:t.map((function(e){return{fileID:e.id,collectionID:e.collectionID}}))},e.next=7,f.Z.post("".concat(x,"/files/trash"),r,null,{"X-Auth-Token":n});case 7:e.next=13;break;case 9:throw e.prev=9,e.t0=e.catch(0),(0,d.H)(e.t0,"trash file failed"),e.t0;case 13:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t){return e.apply(this,arguments)}}(),L=function(){var e=(0,i.Z)(o().mark((function e(t){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,n=(0,p.LP)()){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,f.Z.post("".concat(x,"/trash/delete"),{fileIDs:t},null,{"X-Auth-Token":n});case 6:e.next=12;break;case 8:throw e.prev=8,e.t0=e.catch(0),(0,d.H)(e.t0,"delete from trash failed"),e.t0;case 12:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t){return e.apply(this,arguments)}}(),B=function(){var e=(0,i.Z)(o().mark((function e(t){var n,r,a,u,i,c,s,l;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=(0,p.LP)()){e.next=3;break}return e.abrupt("return");case 3:return r={metadataList:[]},e.next=6,new h.ZP;case 6:a=e.sent,u=b(t),e.prev=8,u.s();case 10:if((i=u.n()).done){e.next=19;break}return c=i.value,e.next=14,a.encryptMetadata(c.magicMetadata.data,c.key);case 14:s=e.sent,l=s.file,r.metadataList.push({id:c.id,magicMetadata:{version:c.magicMetadata.version,count:c.magicMetadata.count,data:l.encryptedData,header:l.decryptionHeader}});case 17:e.next=10;break;case 19:e.next=24;break;case 21:e.prev=21,e.t0=e.catch(8),u.e(e.t0);case 24:return e.prev=24,u.f(),e.finish(24);case 27:return e.next=29,f.Z.put("".concat(x,"/files/magic-metadata"),r,null,{"X-Auth-Token":n});case 29:return e.abrupt("return",t.map((function(e){return g(g({},e),{},{magicMetadata:g(g({},e.magicMetadata),{},{version:e.magicMetadata.version+1})})})));case 30:case"end":return e.stop()}}),e,null,[[8,21,24,27]])})));return function(t){return e.apply(this,arguments)}}(),j=function(){var e=(0,i.Z)(o().mark((function e(t){var n,r,a,u,i,c,s,l;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=(0,p.LP)()){e.next=3;break}return e.abrupt("return");case 3:return r={metadataList:[]},e.next=6,new h.ZP;case 6:a=e.sent,u=b(t),e.prev=8,u.s();case 10:if((i=u.n()).done){e.next=19;break}return c=i.value,e.next=14,a.encryptMetadata(c.pubMagicMetadata.data,c.key);case 14:s=e.sent,l=s.file,r.metadataList.push({id:c.id,magicMetadata:{version:c.pubMagicMetadata.version,count:c.pubMagicMetadata.count,data:l.encryptedData,header:l.decryptionHeader}});case 17:e.next=10;break;case 19:e.next=24;break;case 21:e.prev=21,e.t0=e.catch(8),u.e(e.t0);case 24:return e.prev=24,u.f(),e.finish(24);case 27:return e.next=29,f.Z.put("".concat(x,"/files/public-magic-metadata"),r,null,{"X-Auth-Token":n});case 29:return e.abrupt("return",t.map((function(e){return g(g({},e),{},{pubMagicMetadata:g(g({},e.pubMagicMetadata),{},{version:e.pubMagicMetadata.version+1})})})));case 30:case"end":return e.stop()}}),e,null,[[8,21,24,27]])})));return function(t){return e.apply(this,arguments)}}()},79736:function(e,t,n){"use strict";n.d(t,{Z:function(){return f}});var r=n(30266),a=n(68216),u=n(92809),i=n(809),c=n.n(i),o=n(55733),s=n.n(o),l=n(76102),p=function e(){(0,a.Z)(this,e),(0,u.Z)(this,"image",void 0),(0,u.Z)(this,"video",void 0),(0,u.Z)(this,"imageNameTitle",void 0),(0,u.Z)(this,"videoNameTitle",void 0)},f=function(){var e=(0,r.Z)(c().mark((function e(t,n){var r,a,u;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s().loadAsync(t,{createFolders:!0});case 2:r=e.sent,a=new p,e.t0=c().keys(r.files);case 5:if((e.t1=e.t0()).done){e.next=21;break}if(!(u=e.t1.value).startsWith("image")){e.next=14;break}return a.imageNameTitle=n+(0,l.ue)(u),e.next=11,r.files[u].async("uint8array");case 11:a.image=e.sent,e.next=19;break;case 14:if(!u.startsWith("video")){e.next=19;break}return a.videoNameTitle=n+(0,l.ue)(u),e.next=18,r.files[u].async("uint8array");case 18:a.video=e.sent;case 19:e.next=5;break;case 21:return e.abrupt("return",a);case 22:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},69423:function(e,t,n){"use strict";n.d(t,{VO:function(){return l},HM:function(){return f},BC:function(){return A}});var r=n(30266),a=n(809),u=n.n(a),i=n(99382),c=n(5567),o=n(27108),s=["DateTimeOriginal","CreateDate","ModifyDate","GPSLatitude","GPSLongitude","GPSLatitudeRef","GPSLongitudeRef"];function l(e,t){return p.apply(this,arguments)}function p(){return(p=(0,r.Z)(u().mark((function e(t,n){var r,a,i,s,l;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={location:o.SN,creationTime:null},e.prev=1,e.next=4,f(t,n);case 4:if(s=e.sent){e.next=7;break}return e.abrupt("return",r);case 7:return l={location:h(s),creationTime:A(null!==(a=null!==(i=s.DateTimeOriginal)&&void 0!==i?i:s.CreateDate)&&void 0!==a?a:s.ModifyDate)},e.abrupt("return",l);case 11:return e.prev=11,e.t0=e.catch(1),(0,c.H)(e.t0,"getExifData failed"),e.abrupt("return",r);case 15:case"end":return e.stop()}}),e,null,[[1,11]])})))).apply(this,arguments)}function f(e,t){return d.apply(this,arguments)}function d(){return(d=(0,r.Z)(u().mark((function e(t,n){var r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,i.ZP.parse(t,s);case 3:r=e.sent,e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),(0,c.H)(e.t0,"file missing exif data ",{fileType:n.exactType});case 9:return e.abrupt("return",r);case 10:case"end":return e.stop()}}),e,null,[[0,6]])})))).apply(this,arguments)}function A(e){try{if(!e)return null;var t=1e3*e.getTime();return t<=0?null:t}catch(n){(0,c.H)(n,"getUNIXTime failed",{dateTime:e})}}function h(e){return e.latitude&&e.longitude?{latitude:e.latitude,longitude:e.longitude}:o.SN}},27108:function(e,t,n){"use strict";n.d(t,{SN:function(){return p},mU:function(){return d},zt:function(){return h},a8:function(){return v}});var r=n(30266),a=n(92809),u=n(809),i=n.n(u),c=n(39890),o=n(5567),s=n(69423);function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var p={latitude:null,longitude:null},f=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({creationTime:null,modificationTime:null},p);function d(e,t){return A.apply(this,arguments)}function A(){return(A=(0,r.Z)(i().mark((function e(t,n){var r,a,u,o,l,p,f,d;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(f=null,n.fileType!==c.Gk.IMAGE){e.next=5;break}return e.next=4,(0,s.VO)(t,n);case 4:f=e.sent;case 5:return d={title:t.name,creationTime:null!==(r=null===(a=f)||void 0===a?void 0:a.creationTime)&&void 0!==r?r:1e3*t.lastModified,modificationTime:1e3*t.lastModified,latitude:null===(u=f)||void 0===u||null===(o=u.location)||void 0===o?void 0:o.latitude,longitude:null===(l=f)||void 0===l||null===(p=l.location)||void 0===p?void 0:p.longitude,fileType:n.fileType},e.abrupt("return",d);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var h=function(e,t){return"".concat(e,"_").concat(t)};function v(e){return g.apply(this,arguments)}function g(){return(g=(0,r.Z)(i().mark((function e(t){var n,r,a,u;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,new Promise((function(e,n){var r=new FileReader;r.onabort=function(){return n(Error("file reading was aborted"))},r.onerror=function(){return n(Error("file reading has failed"))},r.onload=function(){var t="string"!==typeof r.result?(new TextDecoder).decode(r.result):r.result;e(JSON.parse(t))},r.readAsText(t)}));case 3:if(n=e.sent,r=f,n&&n.title){e.next=7;break}return e.abrupt("return");case 7:return a=n.title,n.photoTakenTime&&n.photoTakenTime.timestamp?r.creationTime=1e6*n.photoTakenTime.timestamp:n.creationTime&&n.creationTime.timestamp&&(r.creationTime=1e6*n.creationTime.timestamp),n.modificationTime&&n.modificationTime.timestamp&&(r.modificationTime=1e6*n.modificationTime.timestamp),u=p,!n.geoData||0===n.geoData.latitude&&0===n.geoData.longitude?!n.geoDataExif||0===n.geoDataExif.latitude&&0===n.geoDataExif.longitude||(u=n.geoDataExif):u=n.geoData,null!==u&&(r.latitude=u.latitude,r.longitude=u.longitude),e.abrupt("return",{title:a,parsedMetaDataJSON:r});case 16:e.prev=16,e.t0=e.catch(0),(0,o.H)(e.t0,"parseMetadataJSON failed");case 19:case"end":return e.stop()}}),e,null,[[0,16]])})))).apply(this,arguments)}},20147:function(e,t,n){"use strict";n.d(t,{Lc:function(){return g},JB:function(){return m},ui:function(){return x},ce:function(){return C},h5:function(){return T}});var r=n(30266),a=n(29998),u=n(99763),i=n(809),c=n.n(i),o=n(39890),s=n(5567),l=n(86646),p=n(626),f=n.n(p),d=n(65725),A="video",h="image",v="-edited";function g(e,t){return b.apply(this,arguments)}function b(){return(b=(0,r.Z)(c().mark((function e(t,n){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n.size>l.iM)){e.next=4;break}return e.abrupt("return",K(t,n,l.t6));case 4:return e.next=6,t.getUint8ArrayView(n);case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e,t){return y.apply(this,arguments)}function y(){return(y=(0,r.Z)(c().mark((function e(t,n){var r,a,u,i,l;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,w(t,n);case 3:if(a=e.sent,2===(null===(u=null===a||void 0===a?void 0:a.split("/"))||void 0===u?void 0:u.length)){e.next=7;break}throw Error(d.sH.TYPE_DETECTION_FAILED);case 7:e.t0=u[0],e.next=e.t0===h?10:e.t0===A?12:14;break;case 10:return r=o.Gk.IMAGE,e.abrupt("break",15);case 12:return r=o.Gk.VIDEO,e.abrupt("break",15);case 14:r=o.Gk.OTHERS;case 15:return e.abrupt("return",{fileType:r,exactType:u[1]});case 18:if(e.prev=18,e.t1=e.catch(0),i=n.name.split(".").pop(),!(l=o.Rj.find((function(e){return e.exactType===i})))){e.next=24;break}return e.abrupt("return",l);case 24:return(0,s.H)(e.t1,d.sH.TYPE_DETECTION_FAILED,{fileFormat:i}),e.abrupt("return",{fileType:o.Gk.OTHERS,exactType:i});case 26:case"end":return e.stop()}}),e,null,[[0,18]])})))).apply(this,arguments)}function x(e){return e.name.endsWith(v)?e.name.slice(0,-1*v.length):e.name}function w(e,t){return k.apply(this,arguments)}function k(){return(k=(0,r.Z)(c().mark((function e(t,n){var r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.slice(0,4100),e.abrupt("return",C(t,r));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function C(e,t){return E.apply(this,arguments)}function E(){return(E=(0,r.Z)(c().mark((function e(t,n){var r,a;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.getUint8ArrayView(n);case 3:return r=e.sent,e.next=6,f().fromBuffer(r);case 6:return a=e.sent,e.abrupt("return",a.mime);case 10:throw e.prev=10,e.t0=e.catch(0),Error(d.sH.TYPE_DETECTION_FAILED);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})))).apply(this,arguments)}function K(e,t,n){var a=function(e,t,n){return Z.apply(this,arguments)}(e,t,n);return{stream:new ReadableStream({pull:function(e){return(0,r.Z)(c().mark((function t(){var n;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a.next();case 2:(n=t.sent).done?e.close():e.enqueue(n.value);case 4:case"end":return t.stop()}}),t)})))()}}),chunkCount:Math.ceil(t.size/n)}}function Z(){return(Z=(0,u.Z)(c().mark((function e(t,n,r){var u,i,o;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:u=0;case 1:if(!(u<n.size)){e.next=11;break}return i=n.slice(u,r+u),e.next=5,(0,a.Z)(t.getUint8ArrayView(i));case 5:return o=e.sent,e.next=8,o;case 8:u+=r,e.next=1;break;case 11:return e.abrupt("return",null);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(e,t){return P.apply(this,arguments)}function P(){return(P=(0,r.Z)(c().mark((function e(t,n){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,new Promise((function(e,r){t.onabort=function(){return r(Error("file reading was aborted"))},t.onerror=function(){return r(Error("file reading has failed"))},t.onload=function(){var n="string"===typeof t.result?(new TextEncoder).encode(t.result):new Uint8Array(t.result);e(n)},t.readAsArrayBuffer(n)}));case 3:return e.abrupt("return",e.sent);case 6:throw e.prev=6,e.t0=e.catch(0),(0,s.H)(e.t0,"error reading file to byte-array"),e.t0;case 10:case"end":return e.stop()}}),e,null,[[0,6]])})))).apply(this,arguments)}},82736:function(e,t,n){"use strict";n.d(t,{eV:function(){return C}});var r=n(30266),a=n(809),u=n.n(a),i=n(39890),c=n(65725),o=n(5567),s="/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAEBAQEBAQEBAQEBAQE\nBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQ\nEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wAARC\nACWASwDAREAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUF\nBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk\n6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztL\nW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAA\nAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVY\nnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImK\nkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oAD\nAMBAAIRAxEAPwD/AD/6ACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKA\nCgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACg\nAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKAC\ngAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAo\nAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACg\nAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACg\nAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKA\nCgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKA\nCgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoA\nKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACg\nAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAo\nAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKA\nCgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAK\nACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoA\nKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAo\nAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAo\nAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgAoAKACgD/9k=",l=n(68216),p=n(25997),f=n(92809),d=n(15045),A=function(){function e(t){(0,l.Z)(this,e),this.maxParallelProcesses=t,(0,f.Z)(this,"requestQueue",[]),(0,f.Z)(this,"requestInProcessing",0)}return(0,p.Z)(e,[{key:"queueUpRequest",value:function(e){var t=this,n={status:!1},r={exec:function(){n.status=!0}};return{promise:new Promise((function(a,u){t.requestQueue.push({request:e,successCallback:a,failureCallback:u,isCanceled:n,canceller:r}),t.pollQueue()})),canceller:r}}},{key:"pollQueue",value:function(){var e=(0,r.Z)(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.requestInProcessing<this.maxParallelProcesses)){e.next=5;break}return this.requestInProcessing++,e.next=4,this.processQueue();case 4:this.requestInProcessing--;case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"processQueue",value:function(){var e=(0,r.Z)(u().mark((function e(){var t,n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.requestQueue.length>0)){e.next=19;break}if(t=this.requestQueue.pop(),n=null,!t.isCanceled.status){e.next=7;break}t.failureCallback(Error(c.sH.REQUEST_CANCELLED)),e.next=17;break;case 7:return e.prev=7,e.next=10,t.request(t.canceller);case 10:n=e.sent,t.successCallback(n),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(7),t.failureCallback(e.t0);case 17:e.next=0;break;case 19:case"end":return e.stop()}}),e,this,[[7,14]])})));return function(){return e.apply(this,arguments)}}()}]),e}(),h=n(20147);function v(e,t){return g.apply(this,arguments)}function g(){return(g=(0,r.Z)(u().mark((function e(t,n){var r,a,i,c;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r="".concat(Date.now().toString(),"-").concat(n.name),a="".concat(Date.now().toString(),"-thumb.jpeg"),e.t0=t,e.t1=r,e.next=7,(0,h.h5)(new FileReader,n);case 7:e.t2=e.sent,e.t0.FS.call(e.t0,"writeFile",e.t1,e.t2),i=1,c=null;case 11:if(!(i>0)){e.next=25;break}return e.prev=12,e.next=15,t.run("-i",r,"-ss","00:00:0".concat(i.toFixed(3)),"-vframes","1","-vf","scale=-1:720",a);case 15:return c=t.FS("readFile",a),t.FS("unlink",a),e.abrupt("break",25);case 20:e.prev=20,e.t3=e.catch(12),i=Number((i/10).toFixed(3));case 23:e.next=11;break;case 25:return t.FS("unlink",r),e.abrupt("return",c);case 29:throw e.prev=29,e.t4=e.catch(0),(0,o.H)(e.t4,"ffmpeg thumbnail generation failed"),e.t4;case 33:case"end":return e.stop()}}),e,null,[[0,29],[12,20]])})))).apply(this,arguments)}var b=new(function(){function e(){(0,l.Z)(this,e),(0,f.Z)(this,"ffmpeg",null),(0,f.Z)(this,"isLoading",null),(0,f.Z)(this,"generateThumbnailProcessor",new A(1))}return(0,p.Z)(e,[{key:"init",value:function(){var e=(0,r.Z)(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.ffmpeg=(0,d.createFFmpeg)({corePath:"/js/ffmpeg/ffmpeg-core.js"}),this.isLoading=this.ffmpeg.load(),e.next=5,this.isLoading;case 5:this.isLoading=null,e.next=14;break;case 8:throw e.prev=8,e.t0=e.catch(0),(0,o.H)(e.t0,"ffmpeg load failed"),this.ffmpeg=null,this.isLoading=null,e.t0;case 14:case"end":return e.stop()}}),e,this,[[0,8]])})));return function(){return e.apply(this,arguments)}}()},{key:"generateThumbnail",value:function(){var e=(0,r.Z)(u().mark((function e(t){var n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.ffmpeg){e.next=3;break}return e.next=3,this.init();case 3:if(!this.isLoading){e.next=6;break}return e.next=6,this.isLoading;case 6:return n=this.generateThumbnailProcessor.queueUpRequest(v.bind(null,this.ffmpeg,t)),e.prev=7,e.next=10,n.promise;case 10:return e.abrupt("return",e.sent);case 13:if(e.prev=13,e.t0=e.catch(7),e.t0.message!==c.sH.REQUEST_CANCELLED){e.next=19;break}return e.abrupt("return",null);case 19:throw(0,o.H)(e.t0,"ffmpeg thumbnail generation failed"),e.t0;case 21:case"end":return e.stop()}}),e,this,[[7,13]])})));return function(t){return e.apply(this,arguments)}}()}]),e}()),m=n(99424),y=n(76102),x=720,w=102400,k=1e4;function C(e,t,n){return E.apply(this,arguments)}function E(){return(E=(0,r.Z)(u().mark((function e(t,n,r){var a,c,l,p,f,d,A;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,a=!1,c=document.createElement("canvas"),e.prev=3,r.fileType!==i.Gk.IMAGE){e.next=11;break}return p=(0,y.dZ)(r.exactType),e.next=8,K(t,n,p);case 8:c=e.sent,e.next=27;break;case 11:return e.prev=11,e.next=14,b.generateThumbnail(n);case 14:return f=e.sent,d=new File([f],n.name),e.next=18,K(t,d,!1);case 18:c=e.sent,e.next=27;break;case 21:return e.prev=21,e.t0=e.catch(11),(0,o.H)(e.t0,"failed to generate thumbnail using ffmpeg",{fileFormat:r.exactType}),e.next=26,T(n);case 26:c=e.sent;case 27:return e.next=29,O(c);case 29:return A=e.sent,e.next=32,t.getUint8ArrayView(A);case 32:if(0!==(l=e.sent).length){e.next=35;break}throw Error("EMPTY THUMBNAIL");case 35:e.next=42;break;case 37:e.prev=37,e.t1=e.catch(3),(0,o.H)(e.t1,"uploading static thumbnail",{fileFormat:r.exactType}),l=Uint8Array.from(atob(s),(function(e){return e.charCodeAt(0)})),a=!0;case 42:return e.abrupt("return",{thumbnail:l,hasStaticThumbnail:a});case 45:throw e.prev=45,e.t2=e.catch(0),(0,o.H)(e.t2,"Error generating static thumbnail"),e.t2;case 49:case"end":return e.stop()}}),e,null,[[0,45],[3,37],[11,21]])})))).apply(this,arguments)}function K(e,t,n){return Z.apply(this,arguments)}function Z(){return(Z=(0,r.Z)(u().mark((function e(t,n,r){var a,i,o,s,l;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=document.createElement("canvas"),i=a.getContext("2d"),o=null,s=null,!r){e.next=11;break}return e.t0=globalThis.File,e.next=8,t.convertHEIC2JPEG(n);case 8:e.t1=e.sent,e.t2=[e.t1],n=new e.t0(e.t2,null,null);case 11:return l=new Image,o=URL.createObjectURL(n),l.setAttribute("src",o),e.next=16,new Promise((function(e,t){l.onload=function(){try{var n=M({width:l.width,height:l.height},x);a.width=n.width,a.height=n.height,i.drawImage(l,0,0,n.width,n.height),l=null,clearTimeout(s),e(null)}catch(u){var r=(0,c.O4)(u,"".concat(c.sH.THUMBNAIL_GENERATION_FAILED," err: ").concat(u));t(r)}},s=setTimeout((function(){return t(Error(c.sH.WAIT_TIME_EXCEEDED))}),k)}));case 16:return e.abrupt("return",a);case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(e){return P.apply(this,arguments)}function P(){return(P=(0,r.Z)(u().mark((function e(t){var n,r,a,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=document.createElement("canvas"),r=n.getContext("2d"),a=null,i=null,e.next=6,new Promise((function(e,u){var s=document.createElement("video");a=URL.createObjectURL(t),s.addEventListener("loadeddata",(function(){try{if(!s)throw Error("video load failed");var t=M({width:s.videoWidth,height:s.videoHeight},x);n.width=t.width,n.height=t.height,r.drawImage(s,0,0,t.width,t.height),s=null,clearTimeout(i),e(null)}catch(l){var a=Error("".concat(c.sH.THUMBNAIL_GENERATION_FAILED," err: ").concat(l));(0,o.H)(l,c.sH.THUMBNAIL_GENERATION_FAILED),u(a)}})),s.preload="metadata",s.src=a,i=setTimeout((function(){return u(Error(c.sH.WAIT_TIME_EXCEEDED))}),k)}));case 6:return e.abrupt("return",n);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function O(e){return I.apply(this,arguments)}function I(){return(I=(0,r.Z)(u().mark((function e(t){var n,r,a,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=null,r=Number.MAX_SAFE_INTEGER,a=.7;case 3:return n&&(r=n.size),e.next=6,new Promise((function(e){t.toBlob((function(t){e(t)}),"image/jpeg",a)}));case 6:n=e.sent,n=null!==(i=n)&&void 0!==i?i:new Blob([]),a-=.1;case 9:if(a>=.5&&n.size>w&&S(n.size,r)>=10){e.next=3;break}case 10:return n.size>w&&(0,o.H)(Error("thumbnail_too_large"),"thumbnail greater than max limit",{thumbnailSize:(0,m.pe)(n.size)}),e.abrupt("return",n);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(e,t){return 100*(t-e)/t}function M(e,t){if(0===e.height||0===e.width)return{width:0,height:0};var n=t/e.width,r=t/e.height,a=Math.min(n,r),u={width:Math.round(e.width*a),height:Math.round(e.height*a)};return 0===u.width||0===u.height?{width:0,height:0}:u}},74804:function(e,t,n){"use strict";n.d(t,{P:function(){return s}});var r=n(80318),a=n(68216),u=n(25997),i=n(92809);function c(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return o(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var u,i=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){c=!0,u=e},f:function(){try{i||null==n.return||n.return()}finally{if(c)throw u}}}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var s=function(){return 90+10*Math.random()},l=function(){function e(){(0,a.Z)(this,e),(0,i.Z)(this,"perFileProgress",void 0),(0,i.Z)(this,"filesUploaded",void 0),(0,i.Z)(this,"totalFileCount",void 0),(0,i.Z)(this,"fileProgress",void 0),(0,i.Z)(this,"uploadResult",void 0),(0,i.Z)(this,"progressUpdater",void 0)}return(0,u.Z)(e,[{key:"init",value:function(e){this.progressUpdater=e}},{key:"reset",value:function(e){this.setTotalFileCount(e),this.filesUploaded=0,this.fileProgress=new Map,this.uploadResult=new Map,this.updateProgressBarUI()}},{key:"setTotalFileCount",value:function(e){this.totalFileCount=e,this.perFileProgress=100/this.totalFileCount}},{key:"setFileProgress",value:function(e,t){this.fileProgress.set(e,t),this.updateProgressBarUI()}},{key:"setUploadStage",value:function(e){this.progressUpdater.setUploadStage(e)}},{key:"setPercentComplete",value:function(e){this.progressUpdater.setPercentComplete(e)}},{key:"increaseFileUploaded",value:function(){this.filesUploaded++,this.updateProgressBarUI()}},{key:"moveFileToResultList",value:function(e){this.uploadResult.set(e,this.fileProgress.get(e)),this.fileProgress.delete(e),this.updateProgressBarUI()}},{key:"updateProgressBarUI",value:function(){var e=this.progressUpdater,t=e.setPercentComplete,n=e.setFileCounter,a=e.setFileProgress,u=e.setUploadResult;n({finished:this.filesUploaded,total:this.totalFileCount});var i=this.perFileProgress*this.uploadResult.size;if(this.fileProgress){var o,s=c(this.fileProgress);try{for(s.s();!(o=s.n()).done;){var l=(0,r.Z)(o.value,2),p=(l[0],l[1]);p<0||(i+=this.perFileProgress*p/100)}}catch(f){s.e(f)}finally{s.f()}}t(i),a(this.fileProgress),u(this.uploadResult)}},{key:"trackUploadProgress",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s(),r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a={exec:null},u=null,i=function(){u&&clearTimeout(u),u=setTimeout((function(){return a.exec()}),3e4)};return{cancel:a,onUploadProgress:function(a){e&&t.fileProgress.set(e,Math.min(Math.round(n*r+n*a.loaded/a.total),98)),t.updateProgressBarUI(),a.loaded===a.total?clearTimeout(u):i()}}}}]),e}();t.Z=new l},57709:function(e,t,n){"use strict";var r=n(83789),a=n(30266),u=n(68216),i=n(25997),c=n(92809),o=n(809),s=n.n(o),l=n(44796),p=n(9618),f=n(68487),d=n(5567),A=n(65725),h=n(22656),v=(0,p.O3)(),g=function(){function e(){(0,u.Z)(this,e),(0,c.Z)(this,"uploadURLFetchInProgress",null)}return(0,i.Z)(e,[{key:"uploadFile",value:function(){var e=(0,a.Z)(s().mark((function e(t){var n,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,n=(0,f.LP)()){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,(0,h.S)((function(){return l.Z.post("".concat(v,"/files"),t,null,{"X-Auth-Token":n})}),A.a0);case 6:return r=e.sent,e.abrupt("return",r.data);case 10:throw e.prev=10,e.t0=e.catch(0),(0,d.H)(e.t0,"upload Files Failed"),e.t0;case 14:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t){return e.apply(this,arguments)}}()},{key:"fetchUploadURLs",value:function(){var e=(0,a.Z)(s().mark((function e(t,n){var a,u;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.uploadURLFetchInProgress){e.next=14;break}if(e.prev=2,a=(0,f.LP)()){e.next=6;break}return e.abrupt("return");case 6:return this.uploadURLFetchInProgress=l.Z.get("".concat(v,"/files/upload-urls"),{count:Math.min(50,2*t)},{"X-Auth-Token":a}),e.next=9,this.uploadURLFetchInProgress;case 9:u=e.sent,n.push.apply(n,(0,r.Z)(u.data.urls));case 11:return e.prev=11,this.uploadURLFetchInProgress=null,e.finish(11);case 14:return e.abrupt("return",this.uploadURLFetchInProgress);case 17:throw e.prev=17,e.t0=e.catch(0),(0,d.H)(e.t0,"fetch upload-url failed "),e.t0;case 21:case"end":return e.stop()}}),e,this,[[0,17],[2,,11,14]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"fetchMultipartUploadURLs",value:function(){var e=(0,a.Z)(s().mark((function e(t){var n,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,n=(0,f.LP)()){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,l.Z.get("".concat(v,"/files/multipart-upload-urls"),{count:t},{"X-Auth-Token":n});case 6:return r=e.sent,e.abrupt("return",r.data.urls);case 10:throw e.prev=10,e.t0=e.catch(0),(0,d.H)(e.t0,"fetch multipart-upload-url failed"),e.t0;case 14:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t){return e.apply(this,arguments)}}()},{key:"putFile",value:function(){var e=(0,a.Z)(s().mark((function e(t,n,r){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,h.S)((function(){return l.Z.put(t.url,n,null,null,r)}));case 3:return e.abrupt("return",t.objectKey);case 6:throw e.prev=6,e.t0=e.catch(0),(0,d.H)(e.t0,"putFile to dataStore failed "),e.t0;case 10:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"putFilePart",value:function(){var e=(0,a.Z)(s().mark((function e(t,n,r){var u;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,h.S)((0,a.Z)(s().mark((function e(){var a,u,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.Z.put(t,n,null,null,r);case 2:if(null!==(u=e.sent)&&void 0!==u&&null!==(a=u.headers)&&void 0!==a&&a.etag){e.next=7;break}throw i=Error(A.sH.ETAG_MISSING),(0,d.H)(i,"putFile in parts failed"),i;case 7:return e.abrupt("return",u);case 8:case"end":return e.stop()}}),e)}))));case 3:return u=e.sent,e.abrupt("return",u.headers.etag);case 7:throw e.prev=7,e.t0=e.catch(0),(0,d.H)(e.t0,"put filePart failed"),e.t0;case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"completeMultipartUpload",value:function(){var e=(0,a.Z)(s().mark((function e(t,n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,h.S)((function(){return l.Z.post(t,n,null,{"content-type":"text/xml"})}));case 3:e.next=9;break;case 5:throw e.prev=5,e.t0=e.catch(0),(0,d.H)(e.t0,"put file in parts failed"),e.t0;case 9:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(t,n){return e.apply(this,arguments)}}()}]),e}();t.Z=new g},86646:function(e,t,n){"use strict";n.d(t,{JQ:function(){return B},t6:function(){return L},iM:function(){return D},ZP:function(){return H},Ko:function(){return j}});var r=n(80318),a=n(30266),u=n(68216),i=n(25997),c=n(92809),o=n(809),s=n.n(o),l=n(5567),p=n(57709),f=n(27108),d=n(82736),A=n(20147);function h(e,t){return v.apply(this,arguments)}function v(){return(v=(0,a.Z)(s().mark((function e(t,n){var r,u,i,c,o,l,p,f,d;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.stream,u=n.chunkCount,i=r.getReader(),e.next=4,t.initChunkEncryption();case 4:return c=e.sent,o=c.key,l=c.decryptionHeader,p=c.pushState,f={pullCount:1},d=new ReadableStream({pull:function(e){return(0,a.Z)(s().mark((function n(){var r,a,c;return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,i.read();case 2:return r=n.sent,a=r.value,n.next=6,t.encryptFileChunk(a,p,f.pullCount===u);case 6:c=n.sent,e.enqueue(c),f.pullCount===u&&e.close(),f.pullCount++;case 10:case"end":return n.stop()}}),n)})))()}}),e.abrupt("return",{key:o,file:{decryptionHeader:l,encryptedData:{stream:d,chunkCount:u}}});case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e,t){return b.apply(this,arguments)}function b(){return(b=(0,a.Z)(s().mark((function e(t,n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!j(n)){e.next=6;break}return e.next=3,h(t,n);case 3:e.t0=e.sent,e.next=9;break;case 6:return e.next=8,t.encryptFile(n);case 8:e.t0=e.sent;case 9:return e.abrupt("return",e.t0);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var m=n(76640),y=n(7888),x=n(74804),w=n(65725);function k(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return C(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return C(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var u,i=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){c=!0,u=e},f:function(){try{i||null==n.return||n.return()}finally{if(c)throw u}}}}function C(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function E(e){return Math.ceil(e/B)}function K(e,t){return Z.apply(this,arguments)}function Z(){return(Z=(0,a.Z)(s().mark((function e(t,n){var r,a,u;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=E(n.chunkCount),e.next=3,p.Z.fetchMultipartUploadURLs(r);case 3:return a=e.sent,e.next=6,T(a,n.stream,t,r);case 6:return u=e.sent,e.abrupt("return",u);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(e,t,n,r){return P.apply(this,arguments)}function P(){return(P=(0,a.Z)(s().mark((function e(t,n,a,u){var i,c,o,l,f,d,A,h,v,g,b,m;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=n.getReader(),c=O(u),o=[],l=k(t.partURLs.entries()),e.prev=4,l.s();case 6:if((f=l.n()).done){e.next=18;break}return d=(0,r.Z)(f.value,2),A=d[0],h=d[1],e.next=10,I(i);case 10:return v=e.sent,g=x.Z.trackUploadProgress(a,c,A),e.next=14,p.Z.putFilePart(h,v,g);case 14:b=e.sent,o.push({PartNumber:A+1,ETag:b});case 16:e.next=6;break;case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(4),l.e(e.t0);case 23:return e.prev=23,l.f(),e.finish(23);case 26:return e.next=28,i.read();case 28:if(m=e.sent,m.done){e.next=32;break}throw Error(w.sH.CHUNK_MORE_THAN_EXPECTED);case 32:return e.next=34,M(o,t.completeURL);case 34:return e.abrupt("return",t.objectKey);case 35:case"end":return e.stop()}}),e,null,[[4,20,23,26]])})))).apply(this,arguments)}function O(e){return(0,x.P)()/e}function I(e){return S.apply(this,arguments)}function S(){return(S=(0,a.Z)(s().mark((function e(t){var n,r,a,u,i,c;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=[],r=0;case 2:if(!(r<B)){e.next=14;break}return e.next=5,t.read();case 5:if(a=e.sent,u=a.done,i=a.value,!u){e.next=10;break}return e.abrupt("break",14);case 10:for(c=0;c<i.length;c++)n.push(i[c]);case 11:r++,e.next=2;break;case 14:return e.abrupt("return",Uint8Array.from(n));case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e,t){return U.apply(this,arguments)}function U(){return(U=(0,a.Z)(s().mark((function e(t,n){var r,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={compact:!0,ignoreComment:!0,spaces:4},a=y.js2xml({CompleteMultipartUpload:{Part:t}},r),e.next=4,p.Z.completeMultipartUpload(n,a);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function R(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var D=20971520,L=m.kF,B=Math.floor(D/L);function j(e){return"stream"in e}var H=new(function(){function e(){(0,u.Z)(this,e),(0,c.Z)(this,"uploadURLs",[]),(0,c.Z)(this,"metadataMap",void 0),(0,c.Z)(this,"pendingUploadCount",0)}return(0,i.Z)(e,[{key:"init",value:function(){var e=(0,a.Z)(s().mark((function e(t,n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.pendingUploadCount=t,this.metadataMap=n,e.next=4,this.preFetchUploadURLs();case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"readFile",value:function(){var e=(0,a.Z)(s().mark((function e(t,n,r){var a,u,i,c;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,d.eV)(t,n,r);case 2:return a=e.sent,u=a.thumbnail,i=a.hasStaticThumbnail,e.next=7,(0,A.Lc)(t,n);case 7:return c=e.sent,e.abrupt("return",{filedata:c,thumbnail:u,hasStaticThumbnail:i});case 9:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getFileMetadata",value:function(){var e=(0,a.Z)(s().mark((function e(t,n,a){var u,i,c,o,l,p,d,h,v;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=(0,A.ui)(t),c=null!==(u=this.metadataMap.get((0,f.zt)(n.id,i)))&&void 0!==u?u:{},e.next=4,(0,f.mU)(t,a);case 4:o=e.sent,l=0,p=Object.entries(c);case 6:if(!(l<p.length)){e.next=14;break}if(d=(0,r.Z)(p[l],2),h=d[0],v=d[1]){e.next=10;break}return e.abrupt("continue",11);case 10:o[h]=v;case 11:l++,e.next=6;break;case 14:return e.abrupt("return",o);case 15:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"encryptFile",value:function(){var e=(0,a.Z)(s().mark((function e(t,n,r){var a,u,i,c,o,p,f,d,A;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g(t,n.filedata);case 3:return a=e.sent,u=a.key,i=a.file,e.next=8,t.encryptThumbnail(n.thumbnail,u);case 8:return c=e.sent,o=c.file,e.next=12,t.encryptMetadata(n.metadata,u);case 12:return p=e.sent,f=p.file,e.next=16,t.encryptToB64(u,r);case 16:return d=e.sent,A={file:{file:i,thumbnail:o,metadata:f,filename:n.metadata.title},fileKey:d},e.abrupt("return",A);case 21:throw e.prev=21,e.t0=e.catch(0),(0,l.H)(e.t0,"Error encrypting files"),e.t0;case 25:case"end":return e.stop()}}),e,null,[[0,21]])})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"uploadToBucket",value:function(){var e=(0,a.Z)(s().mark((function e(t){var n,r,a,u,i,c;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,n=null,!j(t.file.encryptedData)){e.next=8;break}return e.next=5,K(t.filename,t.file.encryptedData);case 5:n=e.sent,e.next=15;break;case 8:return r=x.Z.trackUploadProgress(t.filename),e.next=11,this.getUploadURL();case 11:return a=e.sent,e.next=14,p.Z.putFile(a,t.file.encryptedData,r);case 14:n=e.sent;case 15:return e.next=17,this.getUploadURL();case 17:return u=e.sent,e.next=20,p.Z.putFile(u,t.thumbnail.encryptedData,null);case 20:return i=e.sent,c={file:{decryptionHeader:t.file.decryptionHeader,objectKey:n},thumbnail:{decryptionHeader:t.thumbnail.decryptionHeader,objectKey:i},metadata:t.metadata},e.abrupt("return",c);case 25:throw e.prev=25,e.t0=e.catch(0),(0,l.H)(e.t0,"error uploading to bucket"),e.t0;case 29:case"end":return e.stop()}}),e,this,[[0,25]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getUploadFile",value:function(e,t,n){var r=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?R(Object(n),!0).forEach((function(t){(0,c.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):R(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({collectionID:e.id,encryptedKey:n.encryptedData,keyDecryptionNonce:n.nonce},t);return r}},{key:"getUploadURL",value:function(){var e=(0,a.Z)(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this.uploadURLs.length||!this.pendingUploadCount){e.next=3;break}return e.next=3,this.fetchUploadURLs();case 3:return e.abrupt("return",this.uploadURLs.pop());case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"preFetchUploadURLs",value:function(){var e=(0,a.Z)(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.fetchUploadURLs();case 3:e.next=9;break;case 5:e.prev=5,e.t0=e.catch(0),(0,l.H)(e.t0,"prefetch uploadURL failed"),(0,w.a0)(e.t0);case 9:case"end":return e.stop()}}),e,this,[[0,5]])})));return function(){return e.apply(this,arguments)}}()},{key:"fetchUploadURLs",value:function(){var e=(0,a.Z)(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.Z.fetchUploadURLs(this.pendingUploadCount,this.uploadURLs);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}())},99424:function(e,t,n){"use strict";n.d(t,{dl:function(){return d},pe:function(){return A},LN:function(){return h},YK:function(){return v},xC:function(){return g},aX:function(){return b},gd:function(){return m},rE:function(){return y},Rf:function(){return x},CF:function(){return w},Mg:function(){return k},EO:function(){return E},Iq:function(){return Z},TV:function(){return P},gT:function(){return I},Cu:function(){return U}});var r,a,u=n(30266),i=n(809),c=n.n(i),o=n(65850),s=n(27145),l=n(35641),p=n(65725),f=n(5567);function d(e,t){return(e/1073741824).toFixed(null!==t&&void 0!==t?t:2)}function A(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(0===e)return"0 MB";var n=Math.floor(Math.log(e)/Math.log(1024)),r=["B","KB","MB","GB","TB","PB","EB","ZB","YB"];return(e/Math.pow(1024,n)).toFixed(t)+" "+r[n]}function h(e){var t;return(e=null!==(t=e)&&void 0!==t?t:y())&&g(e)&&e.productID!==s._}function v(e){var t;return h(e=null!==(t=e)&&void 0!==t?t:y())&&!m(e)}function g(e){var t;return(e=null!==(t=e)&&void 0!==t?t:y())&&e.expiryTime>1e3*Date.now()}function b(e){var t;return(e=null!==(t=e)&&void 0!==t?t:y())&&g(e)&&e.productID===s._}function m(e){var t;return(e=null!==(t=e)&&void 0!==t?t:y())&&e.attributes.isCancelled}function y(){return(0,l.Yu)(l.Pd.SUBSCRIPTION)}function x(e,t){return g(t)&&(e.stripeID===t.productID||e.iosID===t.productID||e.androidID===t.productID)}function w(e){return h(e)&&e.paymentProvider.length>0&&"stripe"===e.paymentProvider}function k(e,t,n,r){return C.apply(this,arguments)}function C(){return(C=(0,u.Z)(c().mark((function e(t,n,r,a){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r(!0),e.next=4,s.Z.updateSubscription(t.stripeID);case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),n({title:o.Z.ERROR,content:o.Z.SUBSCRIPTION_UPDATE_FAILED,close:{variant:"danger"}});case 9:return e.prev=9,r(!1),a(),e.finish(9);case 13:case"end":return e.stop()}}),e,null,[[0,6,9,13]])})))).apply(this,arguments)}function E(e,t,n){return K.apply(this,arguments)}function K(){return(K=(0,u.Z)(c().mark((function e(t,n,r){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r(!0),e.next=4,s.Z.cancelSubscription();case 4:t({title:o.Z.SUCCESS,content:o.Z.SUBSCRIPTION_CANCEL_SUCCESS,close:{variant:"success"}}),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),t({title:o.Z.ERROR,content:o.Z.SUBSCRIPTION_CANCEL_FAILED,close:{variant:"danger"}});case 10:return e.prev=10,n(),r(!1),e.finish(10);case 14:case"end":return e.stop()}}),e,null,[[0,7,10,14]])})))).apply(this,arguments)}function Z(e,t,n){return T.apply(this,arguments)}function T(){return(T=(0,u.Z)(c().mark((function e(t,n,r){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r(!0),e.next=4,s.Z.activateSubscription();case 4:t({title:o.Z.SUCCESS,content:o.Z.SUBSCRIPTION_ACTIVATE_SUCCESS,close:{variant:"success"}}),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),t({title:o.Z.ERROR,content:o.Z.SUBSCRIPTION_ACTIVATE_FAILED,close:{variant:"danger"}});case 10:return e.prev=10,n(),r(!1),e.finish(10);case 14:case"end":return e.stop()}}),e,null,[[0,7,10,14]])})))).apply(this,arguments)}function P(e,t){return O.apply(this,arguments)}function O(){return(O=(0,u.Z)(c().mark((function e(t,n){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n(!0),e.next=4,s.Z.redirectToCustomerPortal();case 4:e.next=10;break;case 6:e.prev=6,e.t0=e.catch(0),n(!1),t({title:o.Z.ERROR,content:o.Z.UNKNOWN_ERROR,close:{variant:"danger"}});case 10:case"end":return e.stop()}}),e,null,[[0,6]])})))).apply(this,arguments)}function I(e,t,n){return S.apply(this,arguments)}function S(){return(S=(0,u.Z)(c().mark((function e(t,n,r){var u,i,l,f,d,A;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=null!==(u=n.query)&&void 0!==u?u:{},l=i.session_id,f=i.status,d=i.reason,e.prev=1,f!==a.fail){e.next=6;break}M(d,t,r),e.next=17;break;case 6:if(f!==a.success){e.next=17;break}return e.prev=7,e.next=10,s.Z.verifySubscription(l);case 10:A=e.sent,t({title:o.Z.SUBSCRIPTION_PURCHASE_SUCCESS_TITLE,close:{variant:"success"},content:o.Z.SUBSCRIPTION_PURCHASE_SUCCESS(null===A||void 0===A?void 0:A.expiryTime)}),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(7),t({title:o.Z.ERROR,content:p.sH.SUBSCRIPTION_VERIFICATION_ERROR,close:{}});case 17:e.next=21;break;case 19:e.prev=19,e.t1=e.catch(1);case 21:case"end":return e.stop()}}),e,null,[[1,19],[7,14]])})))).apply(this,arguments)}function M(e,t,n){switch((0,f.H)(Error(e),"subscription purchase failed"),e){case r.CANCELED:t({title:o.Z.MESSAGE,content:o.Z.SUBSCRIPTION_PURCHASE_CANCELLED,close:{variant:"danger"}});break;case r.REQUIRE_PAYMENT_METHOD:t({title:o.Z.UPDATE_PAYMENT_METHOD,content:o.Z.UPDATE_PAYMENT_METHOD_MESSAGE,staticBackdrop:!0,proceed:{text:o.Z.UPDATE_PAYMENT_METHOD,variant:"success",action:P.bind(null,t,n)},close:{text:o.Z.CANCEL}});break;case r.AUTHENTICATION_FAILED:t({title:o.Z.UPDATE_PAYMENT_METHOD,content:o.Z.STRIPE_AUTHENTICATION_FAILED,staticBackdrop:!0,proceed:{text:o.Z.UPDATE_PAYMENT_METHOD,variant:"success",action:P.bind(null,t,n)},close:{text:o.Z.CANCEL}});break;default:t({title:o.Z.ERROR,content:o.Z.SUBSCRIPTION_PURCHASE_FAILED,close:{variant:"danger"}})}}function U(e){return e?{id:e.productID,storage:e.storage,price:e.price,period:e.period,stripeID:e.productID,iosID:e.productID,androidID:e.productID}:null}!function(e){e.AUTHENTICATION_FAILED="authentication_failed",e.REQUIRE_PAYMENT_METHOD="requires_payment_method",e.STRIPE_ERROR="stripe_error",e.CANCELED="canceled",e.SERVER_ERROR="server_error"}(r||(r={})),function(e){e.success="success",e.fail="fail"}(a||(a={}))},76102:function(e,t,n){"use strict";n.d(t,{KG:function(){return m},Sv:function(){return y},dZ:function(){return w},N0:function(){return k},Rb:function(){return C},p6:function(){return E},o0:function(){return K},Km:function(){return Z},hE:function(){return T},np:function(){return P},nO:function(){return I},AA:function(){return S},ue:function(){return M},J9:function(){return U},jR:function(){return R},au:function(){return D},Ll:function(){return B},Iq:function(){return N},rx:function(){return G},tc:function(){return Y},eO:function(){return X},SA:function(){return W},Vz:function(){return z},G5:function(){return J},zO:function(){return ee},GG:function(){return te},SG:function(){return re}});var r=n(92809),a=n(80318),u=n(30266),i=n(809),c=n.n(i),o=n(39890),s=n(79736),l=n(20147),p=n(39903),f=n(5567),d=n(8635),A=n(35641);function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function v(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function g(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return b(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return b(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var u,i=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){c=!0,u=e},f:function(){try{i||null==n.return||n.return()}finally{if(c)throw u}}}}function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function m(e,t){var n=new Blob([t],{type:"text/plain"}),r=document.createElement("a");r.href=URL.createObjectURL(n),r.download=e,r.style.display="none",document.body.appendChild(r),r.click(),r.remove()}function y(e){return x.apply(this,arguments)}function x(){return(x=(0,u.Z)(c().mark((function e(t){var n,r,a;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=document.createElement("a")).style.display="none",e.next=4,p.Z.getCachedOriginalFile(t);case 4:if(null===(r=e.sent)||void 0===r){e.next=9;break}e.t0=r,e.next=18;break;case 9:return e.t1=URL,e.t2=Response,e.next=13,p.Z.downloadFile(t);case 13:return e.t3=e.sent,e.next=16,new e.t2(e.t3).blob();case 16:e.t4=e.sent,e.t0=e.t1.createObjectURL.call(e.t1,e.t4);case 18:a=e.t0,n.href=a,t.metadata.fileType===o.Gk.LIVE_PHOTO?n.download=S(t.metadata.title)+".zip":n.download=t.metadata.title,document.body.appendChild(n),n.click(),n.remove();case 24:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e){return e&&(e.toLowerCase().endsWith("heic")||e.toLowerCase().endsWith("heif"))}function k(e){var t,n=new Map,r=g(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;n.has(a.collectionID)||n.set(a.collectionID,[]),n.get(a.collectionID).push(a)}}catch(u){r.e(u)}finally{r.f()}return n}function C(e,t){var n,r=new Set(function(e){for(var t=[],n=0,r=Object.entries(e);n<r.length;n++){var u=(0,a.Z)(r[n],2),i=u[0],c=u[1];"boolean"===typeof c&&c&&t.push(Number(i))}return t}(e)),u=[],i=new Set,c=g(t);try{for(c.s();!(n=c.n()).done;){var o=n.value;r.has(o.id)&&!i.has(o.id)&&(u.push(o),i.add(o.id))}}catch(s){c.e(s)}finally{c.f()}return u}function E(e){return new Intl.DateTimeFormat("en-IN",{weekday:"short",year:"numeric",month:"long",day:"numeric"}).format(e)}function K(e){var t=new Intl.DateTimeFormat("en-IN",{weekday:"short",year:"numeric",month:"long",day:"numeric"}),n=new Intl.DateTimeFormat("en-IN",{timeStyle:"medium"});return"".concat(t.format(e)," ").concat(n.format(e))}function Z(e){var t={year:31536e6,month:2628e6,day:864e5,hour:36e5,minute:6e4,second:1e3},n=new Intl.RelativeTimeFormat("en-IN",{localeMatcher:"best fit",numeric:"always",style:"long"}),r=e-Date.now();for(var a in t)if(Math.abs(r)>t[a]||"second"===a)return n.format(Math.round(r/t[a]),a)}function T(e){return e=(e=e.sort((function(e,t){var n,r;return null!==(n=t.metadata)&&void 0!==n&&n.modificationTime?null!==(r=e.metadata)&&void 0!==r&&r.modificationTime?t.metadata.modificationTime-e.metadata.modificationTime:1:-1}))).map((function(e,t){return{index:t,file:e}})).sort((function(e,t){var n=t.file.metadata.creationTime-e.file.metadata.creationTime;return 0===n&&(n=e.index-t.index),n})).map((function(e){return e.file}))}function P(e,t){return O.apply(this,arguments)}function O(){return(O=(0,u.Z)(c().mark((function e(t,n){var r,a,u,i;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,new d.ZP;case 3:return u=e.sent,e.next=6,u.decryptB64(t.encryptedKey,t.keyDecryptionNonce,n.key);case 6:return t.key=e.sent,i=t.metadata,e.next=10,u.decryptMetadata(i.encryptedData,i.decryptionHeader,t.key);case 10:if(t.metadata=e.sent,null===(r=t.magicMetadata)||void 0===r||!r.data){e.next=15;break}return e.next=14,u.decryptMetadata(t.magicMetadata.data,t.magicMetadata.header,t.key);case 14:t.magicMetadata.data=e.sent;case 15:if(null===(a=t.pubMagicMetadata)||void 0===a||!a.data){e.next=19;break}return e.next=18,u.decryptMetadata(t.pubMagicMetadata.data,t.pubMagicMetadata.header,t.key);case 18:t.pubMagicMetadata.data=e.sent;case 19:return e.abrupt("return",t);case 22:throw e.prev=22,e.t0=e.catch(0),(0,f.H)(e.t0,"file decryption failed"),e.t0;case 26:case"end":return e.stop()}}),e,null,[[0,22]])})))).apply(this,arguments)}function I(e){return e.map((function(e){return delete e.src,delete e.msrc,delete e.file.objectKey,delete e.thumbnail.objectKey,delete e.h,delete e.html,delete e.w,e}))}function S(e){var t=e.lastIndexOf(".");return-1===t?e:e.substr(0,t)}function M(e){var t=e.lastIndexOf(".");return-1===t?"":e.substr(t)}function U(e){var t=e.lastIndexOf(".");return-1===t?[e,null]:[e.substr(0,t),e.substr(t+1)]}function R(e){return new ReadableStream({start:function(t){return(0,u.Z)(c().mark((function n(){return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:t.enqueue(e),t.close();case 2:case"end":return n.stop()}}),n)})))()}})}function D(e,t){return L.apply(this,arguments)}function L(){return(L=(0,u.Z)(c().mark((function e(t,n){var r,a,u,i,p;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.metadata.fileType!==o.Gk.LIVE_PHOTO){e.next=6;break}return a=S(t.metadata.title),e.next=4,(0,s.Z)(n,a);case 4:u=e.sent,n=new Blob([u.image]);case 6:return i=t.metadata.title.split(".")[-1],e.next=9,new d.ZP;case 9:return p=e.sent,e.next=12,(0,l.ce)(p,n);case 12:if(e.t1=r=e.sent,e.t0=null!==e.t1,!e.t0){e.next=16;break}e.t0=void 0!==r;case 16:if(!e.t0){e.next=20;break}e.t2=r,e.next=21;break;case 20:e.t2=i;case 21:if(!w(e.t2)){e.next=26;break}return e.next=25,p.convertHEIC2JPEG(n);case 25:n=e.sent;case 26:return e.abrupt("return",n);case 27:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function B(e){return!!(e&&e.magicMetadata&&e.magicMetadata.data&&"string"!==typeof e.magicMetadata.data&&"undefined"!==typeof e.magicMetadata.data.visibility)&&e.magicMetadata.data.visibility===o.YU.ARCHIVED}function j(e,t){return H.apply(this,arguments)}function H(){return(H=(0,u.Z)(c().mark((function e(t,n){var r,a;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new d.ZP;case 2:if(r=e.sent,t.magicMetadata||(t.magicMetadata=o.Zt),"string"!==typeof t.magicMetadata.data){e.next=8;break}return e.next=7,r.decryptMetadata(t.magicMetadata.data,t.magicMetadata.header,t.key);case 7:t.magicMetadata.data=e.sent;case 8:if(!n){e.next=13;break}return a=v(v({},t.magicMetadata.data),n),e.abrupt("return",v(v({},t),{},{magicMetadata:v(v({},t.magicMetadata),{},{data:a,count:Object.keys(t.magicMetadata.data).length})}));case 13:return e.abrupt("return",t);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _(e,t){return F.apply(this,arguments)}function F(){return(F=(0,u.Z)(c().mark((function e(t,n){var r,a;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new d.ZP;case 2:if(r=e.sent,t.pubMagicMetadata||(t.pubMagicMetadata=o.Zt),"string"!==typeof t.pubMagicMetadata.data){e.next=8;break}return e.next=7,r.decryptMetadata(t.pubMagicMetadata.data,t.pubMagicMetadata.header,t.key);case 7:t.pubMagicMetadata.data=e.sent;case 8:if(!n){e.next=13;break}return a=v(v({},t.pubMagicMetadata.data),n),e.abrupt("return",v(v({},t),{},{pubMagicMetadata:v(v({},t.pubMagicMetadata),{},{data:a,count:Object.keys(t.pubMagicMetadata.data).length})}));case 13:return e.abrupt("return",t);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function N(e,t,n){return Q.apply(this,arguments)}function Q(){return(Q=(0,u.Z)(c().mark((function e(t,n,r){var a,u,i,o,s,l;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=C(n,t),u=[],i=g(a),e.prev=3,i.s();case 5:if((o=i.n()).done){e.next=15;break}return s=o.value,l={visibility:r},e.t0=u,e.next=11,j(s,l);case 11:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 13:e.next=5;break;case 15:e.next=20;break;case 17:e.prev=17,e.t2=e.catch(3),i.e(e.t2);case 20:return e.prev=20,i.f(),e.finish(20);case 23:return e.abrupt("return",u);case 24:case"end":return e.stop()}}),e,null,[[3,17,20,23]])})))).apply(this,arguments)}function G(e,t){return V.apply(this,arguments)}function V(){return(V=(0,u.Z)(c().mark((function e(t,n){var r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={editedTime:n},e.next=3,_(t,r);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Y(e,t){return q.apply(this,arguments)}function q(){return(q=(0,u.Z)(c().mark((function e(t,n){var r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={editedName:n},e.next=3,_(t,r);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function X(e){var t=(0,A.Yu)(A.Pd.USER);return!(null===t||void 0===t||!t.id||null===e||void 0===e||!e.ownerID)&&e.ownerID!==t.id}function W(e){return e.map((function(e){var t,n,r,a;return v(v({},e),{},{metadata:v(v(v({},e.metadata),null!==(t=e.pubMagicMetadata)&&void 0!==t&&t.data?v(v({},(null===(n=e.pubMagicMetadata)||void 0===n?void 0:n.data.editedTime)&&{creationTime:e.pubMagicMetadata.data.editedTime}),(null===(r=e.pubMagicMetadata)||void 0===r?void 0:r.data.editedName)&&{title:e.pubMagicMetadata.data.editedName}):{}),null!==(a=e.magicMetadata)&&void 0!==a&&a.data?e.magicMetadata.data:{})})}))}function z(e,t){e.pubMagicMetadata=t.pubMagicMetadata,e.metadata=W([e])[0].metadata}function J(e){return $.apply(this,arguments)}function $(){return($=(0,u.Z)(c().mark((function e(t){var n,r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t);case 2:return e.next=4,e.sent.blob();case 4:return n=e.sent,r=new globalThis.File([n],"temp"),e.abrupt("return",r);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ee(e){var t,n=null!==(t=(0,A.Yu)(A.Pd.USER))&&void 0!==t?t:{};return function(e){var t=new Set;return e.filter((function(e){return!t.has(e.id)&&(t.add(e.id),!0)}))}(e.filter((function(e){return("undefined"===typeof e.isTrashed||!e.isTrashed)&&(!n.id||e.ownerID===n.id)})))}function te(e){return ne.apply(this,arguments)}function ne(){return(ne=(0,u.Z)(c().mark((function e(t){var n,r,a;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=g(t),e.prev=1,n.s();case 3:if((r=n.n()).done){e.next=15;break}return a=r.value,e.prev=5,e.next=8,y(a);case 8:e.next=13;break;case 10:e.prev=10,e.t0=e.catch(5),(0,f.H)(e.t0,"download fail for file");case 13:e.next=3;break;case 15:e.next=20;break;case 17:e.prev=17,e.t1=e.catch(1),n.e(e.t1);case 20:return e.prev=20,n.f(),e.finish(20);case 23:case"end":return e.stop()}}),e,null,[[1,17,20,23],[5,10]])})))).apply(this,arguments)}function re(e){var t=U(e.metadata.title)[1];return!!(e.metadata.fileType===o.Gk.LIVE_PHOTO||e.metadata.fileType===o.Gk.IMAGE&&w(t))}},22656:function(e,t,n){"use strict";n.d(t,{S:function(){return o}});var r=n(30266),a=n(809),u=n.n(a),i=n(31262),c=[2e3,5e3,1e4];function o(e,t){return s.apply(this,arguments)}function s(){return(s=(0,r.Z)(u().mark((function e(t,n){var a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=function(){var e=(0,r.Z)(u().mark((function e(t){var r,o,s=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>1&&void 0!==s[1]?s[1]:0,e.prev=1,e.next=4,t();case 4:return o=e.sent,e.abrupt("return",o);case 8:if(e.prev=8,e.t0=e.catch(1),n&&n(e.t0),!(r<c.length)){e.next=19;break}return e.next=14,(0,i._v)(c[r]);case 14:return e.next=16,a(t,r+1);case 16:return e.abrupt("return",e.sent);case 19:throw e.t0;case 20:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}(),e.next=3,a(t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},66091:function(e,t,n){"use strict";n.d(t,{aF:function(){return a},Qj:function(){return u},fo:function(){return i},n_:function(){return c}});var r=n(35641),a=function(){var e,t;return null!==(e=null===(t=(0,r.Yu)(r.Pd.IS_FIRST_LOGIN))||void 0===t?void 0:t.status)&&void 0!==e&&e};function u(e){(0,r.a_)(r.Pd.IS_FIRST_LOGIN,{status:e})}var i=function(){var e,t;return null!==(e=null===(t=(0,r.Yu)(r.Pd.JUST_SIGNED_UP))||void 0===t?void 0:t.status)&&void 0!==e&&e};function c(e){(0,r.a_)(r.Pd.JUST_SIGNED_UP,{status:e})}},69386:function(){},31616:function(){},99283:function(){},43838:function(){},69862:function(){},40964:function(){}}]);
//# sourceMappingURL=733-7c4f559d5304400cfad4.js.map